/*!
 * ©2012-2016, gxb.wechat v1.0.0
 * Description: 高校邦微信项目 - 粉笔匠
 * Author: GXB Development Group
 * Build Time: Thu Mar 09 2017 18:25:34 GMT+0800 (CST)
 */
!function(e){e.baseCtrl=function(){},e.baseCtrl.prototype.getContext=function(){},e.checkLocalData=function(o){return/wechat/.test(window.location.hash)||""==window.location.hash?{state:"0",message:"数据"+o+"存在",data:window.localStorage[o]}:void(window.localStorage[o]||(alert("本地缓存数据丢失，即将发起重新登录"),e.clearLocalData(),window.location.href=window.location.origin))},e.clearLocalData=function(e){window.localStorage.clear(),"function"==typeof e&&e(),window.location.href=window.location.origin}}(gxb.controllers),function(e){e.registerNamespace("gxb.controllers.users"),e.registerNamespace("gxb.controllers.intro"),e.registerNamespace("gxb.controllers.course"),e.registerNamespace("gxb.controllers.chapter"),e.registerNamespace("gxb.controllers.chapterVideo"),e.registerNamespace("gxb.controllers.demo")}(gxb.components),function(e){e.users.bindAccountCtrl=function(e){var o;e.$scope.paracont="点击获取",e.$scope.paraclass="no_yzm",e.$scope.second=60,e.$scope.message="",e.$scope.loading="none",sessionStorage.getItem("wechatUserInfo")&&(o=JSON.parse(sessionStorage.getItem("wechatUserInfo")),e.$scope.userObj=o),e.$scope.account={mobile:"",validateCode:""},e.$scope.getCode=function(){e.$scope.loading="inline";var o=e.$scope.account.mobile;if(o){if(!e.$userSrv.verifyMobile(o))return e.$scope.message="请输入正确的手机格式!",e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}),!1;e.$userSrv.getMobileCode(o).then(function(o){"0"==o.status?(e.$scope.loading="none",e.$scope.timePromise=e.$interval(function(){e.$scope.second<=0?(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="点击获取",e.$scope.paraclass="get_code",e.$scope.paraevent=!0):(e.$scope.paracont=e.$scope.second+"s后重试",e.$scope.paraclass="no_yzm",e.$scope.second--)},1e3,100),e.$scope.message="发送验证码成功！",e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500})):"1"==o.status&&(e.$scope.message=o.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))})}},e.$scope.submit=function(){var s={mobile:e.$scope.account.mobile,validateCode:e.$scope.account.validateCode,openId:o.openid,unionId:o.unionid};e.$userSrv.checkMobileCode(s).then(function(o){window.sessionStorage.setItem("MobileCodeData",gxb.utils.jsonUtils.toString(s)),"0"==o.status?(e.$scope.message="绑定成功",e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500,callback:function(){window.sessionStorage.setItem("bindingStatus","1"),e.$state.go("course_index",{courseId:1},{reload:!0})}})):"1"==o.status?(e.$scope.message=o.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500})):"2"==o.status?e.$state.go("register",{reload:!0}):"3"==o.status&&(window.sessionStorage.setItem("token",o.data.accessToken),e.$state.go("certification",{reload:!0}))})}},e.inheritFromCtrl(e.users.bindAccountCtrl),e.registerDependency("gxb.controllers.users.bindAccountCtrl",["gxb.services.users.userSrv","ngDialog"]),e.registerView("gxb.controllers.users.bindAccountCtrl","bindAccount")}(gxb.controllers),function(e){e.users.certificationCtrl=function(e){e.$scope.tab=0,e.$scope.message="",e.$scope.isOpen=!1,e.$scope.isWrite=!1,e.$scope.isAbout=!1,e.$scope.config={schoolName:"请选择你的学校",tenantName:"填写你在本校的学号",userName:"输入你的真实姓名"};var o=sessionStorage.getItem("token");e.$certificationSrv.getSchoolList().then(function(o){e.$scope.safeApply(function(){e.$scope.getSchoolData=o})}),e.$scope.changeSchool=function(){e.$state.go("schoolList",{},{reload:!0})},e.$scope.schoolMsg={name:"请选择你的学校",tenantId:""};var s=JSON.parse(sessionStorage.getItem("bindingSchoolData"));s&&s.name&&(e.$scope.schoolMsg.name=s.name),s&&s.tenantId&&(e.$scope.schoolMsg.tenantId=s.tenantId),e.$scope.bindingSchoolBtn=function(){var s={},t=($("#schoolName").val(),e.$scope.schoolMsg.tenantId),n=$("#tenantId").val(),c=$("#userName").val();t&&n&&c&&(s.no=n,s.name=c,s.tenantId=t,e.$certificationSrv.bindingSchool(o,s).then(function(o){"0"==o.status||o.status?"1"==o.status?(e.$scope.message=o.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500})):(sessionStorage.setItem("bindingStatus",1),e.$state.go("course_index",{courseId:1},{reload:!0})):(e.$scope.message=o.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))}))}},e.inheritFromCtrl(e.users.certificationCtrl),e.registerDependency("gxb.controllers.users.certificationCtrl",["gxb.services.users.certificationSrv"]),e.registerView("gxb.controllers.users.certificationCtrl","certification")}(gxb.controllers),function(e){e.users.personalCtrl=function(e){if(e.$scope.tab=0,e.$scope.credit=!1,e.$scope.report=1,e.$scope.status=1,e.$scope.message="",e.$scope.isOpen=!1,e.$scope.isWrite=!1,e.$scope.isAbout=!1,sessionStorage.getItem("wechatUserInfo")&&(e.$scope.UserInfo=JSON.parse(sessionStorage.getItem("wechatUserInfo"))),sessionStorage.getItem("token"))var o=sessionStorage.getItem("token");e.$scope.date=function(e){var o,s=new Date(parseInt(e)),t=(s.getFullYear(),s.getMonth()+1),n=s.getDate();return t<10&&(t="0"+t),n<10&&(n="0"+n),o=s.getFullYear()+"."+(s.getMonth()+1)+"."+s.getDate()},e.$userSrv.checkReport(o).then(function(o){o&&(e.$scope.data=o)}),e.$userSrv.getReport(o).then(function(o){"1"==o.status?e.$scope.status=1:400==o.status?e.$scope.status=1:e.$scope.status=0,o.data&&(1==o.data.exchangecredits?e.$scope.credit=!1:e.$scope.credit=!0)}),e.$scope.goReport=function(){e.$scope.tab=0},e.$scope.goCredit=function(){e.$scope.tab=1},e.$scope.goSetting=function(){e.$scope.tab=2},e.$scope.open=function(){0==e.$scope.isOpen?e.$scope.isOpen=!0:e.$scope.isOpen=!1;sessionStorage.getItem("isWifi")},e.$scope.goMake=function(){e.$state.go("personal_report",{reload:!0})},e.$scope.applyFor=function(){e.$userSrv.getScore(o).then(function(o){"0"==o.status?e.$scope.safeApply(function(){e.$scope.credit=!1,e.$scope.report=0}):(e.$scope.report=1,e.$scope.message=o.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))})},e.$scope.writeIdea=function(){0==e.$scope.isWrite&&(e.$scope.isWrite=!0)},e.$scope.credit={text:""},e.$scope.send=function(o){o?e.$scope.isWrite=!1:(e.$scope.message="您还没有填写内容！",e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}));var s={text:o};e.$userSrv.getCredit(e.$scope.UserInfo.unionid,s).then(function(o){"0"==o.status&&(e.$scope.credit.text="",e.$scope.message="发送成功！",e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))})},e.$scope.cancel=function(){e.$scope.isWrite=!1},e.$scope.getAbout=function(){e.$scope.isAbout=!0},e.$scope.getClose=function(){e.$scope.isAbout=!1}},e.inheritFromCtrl(e.users.personalCtrl),e.registerDependency("gxb.controllers.users.personalCtrl",["gxb.services.users.userSrv","ngDialog"]),e.registerView("gxb.controllers.users.personalCtrl","personal")}(gxb.controllers),function(e){e.users.registerCtrl=function(e){var o,s;e.$scope.register={password:""},e.$scope.message="";sessionStorage.getItem("wechatUserInfo")&&(e.$scope.wxUserInfo=JSON.parse(sessionStorage.getItem("wechatUserInfo"))),sessionStorage.getItem("MobileCodeData")&&(s=JSON.parse(sessionStorage.getItem("MobileCodeData"))),e.$scope.register=function(){var t={unionId:e.$scope.wxUserInfo.unionid,openId:e.$scope.wxUserInfo.openid,encryptedPassword:e.$scope.register.password,mobile:s.mobile,validateCode:s.validateCode,avatarUrl:e.$scope.wxUserInfo.avatar,username:e.$scope.wxUserInfo.nickname};if(e.$scope.register.password){if(!e.$userSrv.verifyPassword(e.$scope.register.password))return e.$scope.message="6~16位至少包含数字、字母或符号的两种",e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}),!1;e.$userSrv.getRegister(t).then(function(s){"0"==s.status?(o=JSON.parse(sessionStorage.getItem("wechatUserInfo")),o.nickname=s.data.username,o.avatar=s.data.avatarUrl,sessionStorage.setItem("wechatUserInfo",gxb.utils.jsonUtils.toString(o)),window.sessionStorage.setItem("token",s.data.accessToken),window.sessionStorage.setItem("mobile",s.data.mobile),sessionStorage.getItem("bindingStatus")?e.$state.go("course_index",{courseId:1},{reload:!0}):e.$state.go("certification",{reload:!0})):"1"==s.status&&(e.$scope.message=s.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))})}}},e.inheritFromCtrl(e.users.registerCtrl),e.registerDependency("gxb.controllers.users.registerCtrl",["gxb.services.users.userSrv","ngDialog"]),e.registerView("gxb.controllers.users.registerCtrl","register")}(gxb.controllers),function(e){e.users.schoolListCtrl=function(e){e.$scope.searchName="",e.$certificationSrv.getSchoolList().then(function(o){e.$scope.safeApply(function(){e.$scope.schoolListData=o})}),e.$scope.schoolListClick=function(o,s){var t={};t.tenantId=o,t.name=s,sessionStorage.setItem("bindingSchoolData",JSON.stringify(t)),e.$state.go("certification",{},{reload:!0})}},e.inheritFromCtrl(e.users.schoolListCtrl),e.registerDependency("gxb.controllers.users.schoolListCtrl",["gxb.services.users.certificationSrv"]),e.registerView("gxb.controllers.users.schoolListCtrl","schoolList")}(gxb.controllers),function(e){e.users.wechatCtrl=function(e){function o(o){e.$scope.safeApply(function(){e.$scope.tipText=o.message,e.$scope.reloadPageFlag=1,setTimeout(function(){$("#loadingToast").hide(),"function"==typeof o.callback&&o.callback()},o.time)})}function s(e){var o=window.location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));if(!(null==o||o.length<1))return decodeURIComponent(o[1])}gxb.utils.ajaxUtils.changeWechatDocumentTitle("智慧选修课");var t=window.navigator.userAgent.toLowerCase();e.$scope.warning=0,e.$scope.reloadPageFlag=0,e.$scope.dialog={title:"提示",content:""},e.code=s("code"),e.code&&"micromessenger"==t.match(/MicroMessenger/i)?(window.sessionStorage.setItem("code",e.code),window.sessionStorage.getItem("wechatUserInfo")||$.ajax({type:"GET",url:window.location.protocol+"//psychology.gaoxiaobang.com/login/wxlogin?code="+e.code,timeout:8e3,success:function(s){if(s.data){var t=JSON.parse(s.data),n={uid:t.model.userinfo.uid,openid:t.model.userinfo.openid,unionid:t.model.userinfo.unionid,nickname:t.model.userinfo.nickname,avatar:t.model.userinfo.avatar},c="openId="+t.model.userinfo.openid+"&unionId="+t.model.userinfo.unionid;window.sessionStorage.setItem("wechatUserInfo",gxb.utils.jsonUtils.toString(n)),e.$wechatSrv.checkOpenId(c).then(function(e){if("0"==e.status){""!=e.data&&e.data&&(window.sessionStorage.setItem("mobile",e.data.mobile),window.sessionStorage.setItem("token",e.data.accessToken),window.sessionStorage.setItem("bindingStatus",e.bindingStatus));gxb.utils.jsonUtils.toObject(window.sessionStorage.getItem("previousState"));window.location.href=window.location.origin+window.location.pathname+"#/intro"}else o({message:"登录失败",time:2e3})},function(){o({message:"登录失败",time:2e3})})}else window.sessionStorage.getItem("wechatUserInfo")?window.location.href=window.location.origin+window.location.pathname+"#/intro":o({message:"登录失败",time:2e3})},error:function(e,s){o({message:"登录失败",time:2e3})}})):window.location.href=window.location.protocol+"//bigbang.gaoxiaobang.com/dist/index.html",e.$scope.reloadPage=function(){window.location.href=window.location.origin+window.location.pathname}},e.inheritFromCtrl(e.users.wechatCtrl),e.registerDependency("gxb.controllers.users.wechatCtrl",["gxb.services.users.wechatSrv"]),e.registerView("gxb.controllers.users.wechatCtrl","wechat")}(gxb.controllers),function(e){e.intro.introCtrl=function(e){var o;e.$scope.num=0,e.$scope.toggleAnimation=function(){$("#handShankView").toggleClass("handShank__view--animation")},$("#handShank").on({touchstart:function(s){s.preventDefault(),o=setInterval(function(){150==e.$scope.num&&(clearInterval(o),e.$scope.safeApply(function(){e.$scope.num=0}),e.$state.go("course_list",{},{reload:!0})),e.$scope.safeApply(function(){e.$scope.num++})},1),$("#handShankView").addClass("handShank__view--svg"),window.setTimeout(function(){$("#handShankView").removeClass("handShank__view--svg")},2),e.$scope.toggleAnimation()},touchend:function(s){e.$scope.toggleAnimation(),clearInterval(o),150==e.$scope.num?e.$state.go("course_list",{},{reload:!0}):e.$scope.safeApply(function(){e.$scope.num=0})}})},e.inheritFromCtrl(e.intro.introCtrl),e.registerDependency("gxb.controllers.intro.introCtrl",["$stateParams","$state","$rootScope"]),e.registerView("gxb.controllers.intro.introCtrl","intro")}(gxb.controllers),function(e){e.course.courseIndexCtrl=function(e){var o,s=(e.$stateParams.courseId,window.sessionStorage.getItem("wechatUserInfo"));e.$scope.num=0,e.$scope.ngDialogTips="",s||(e.$scope.safeApply(function(){e.$scope.ngDialogTips="用户信息有误，请重新访问！"}),e.ngDialog.open({template:"dialog-chapter-lock",scope:e.$scope,timeout:1500,callback:function(){e.$state.go("course_list",{},{reload:!0})}})),s=JSON.parse(s);var t=e.$sce;e.$scope.config={sources:"",tracks:[{src:window.location.protocol+"//www.videogular.com/assets/subs/pale-blue-dot.vtt",kind:"subtitles",srclang:"en",label:"English","default":""}],theme:"bower_components/videogular-themes-default/videogular.css",plugins:{poster:window.location.protocol+"//www.videogular.com/assets/images/videogular.png"},autoPlay:!0,currentTime:!1},t.API=null,e.$scope.onPlayerReady=function(e){t.API=e},e.$scope.onClickFullScreen=function(){t.API.toggleFullScreen(),t.API.play()},e.$scope.courseData={extra:{progresswidth:"0%",progresstips:"",userId:s.uid,unionId:s.unionid},serverData:{getUserInfo:{}},chapterList:[{chapterId:15,name:"第十五章",islock:!0,slogan:"故立志者，为学之心也；为学者，立志之事也。 —— 王阳明"},{chapterId:14,name:"第十四章",islock:!0,slogan:"千磨万击还坚韧，任尔东南西北风。 —— 郑板桥"},{chapterId:13,name:"第十三章",islock:!0,slogan:"能克服困难的人，可使困难化为良机。 —— 丘吉尔"},{chapterId:12,name:"第十二章",islock:!0,slogan:"日日行，不怕千万里；常常做，不怕千万事。 —— 金樱"},{chapterId:11,name:"第十一章",islock:!0,slogan:"如烟往事俱忘却，心底无私天地宽。 —— 陶铸"},{chapterId:10,name:"第十章",islock:!0,slogan:"患难困苦，是磨炼人格之最高学校。 —— 梁启超"},{chapterId:9,name:"第九章",islock:!0,slogan:"英雄常食苦难与试练的面包。 —— 罗曼罗兰"},{chapterId:8,name:"第八章",islock:!0,slogan:"勤劳一日，可得一夜安眠；勤劳一生，可得幸福长眠。 —— 达芬奇"},{chapterId:7,name:"第七章",islock:!0,slogan:"锲而舍之，朽木不折；锲而不舍，金石可镂。 —— 荀况"},{chapterId:6,name:"第六章",islock:!0,slogan:"所有坚忍不拔的努力迟早会取得报酬的。 —— 安格尔"},{chapterId:5,name:"第五章",islock:!0,slogan:"顺境中的好运，为人们所希冀；逆境中的好运，则为人们所惊奇。 —— 培根"},{chapterId:4,name:"第四章",islock:!0,slogan:"强烈的信仰会赢取坚强的人，然后又使他们更坚强。 —— 华特贝基霍"},{chapterId:3,name:"第三章",islock:!0,slogan:"古之立大事者，不惟有超世之才，亦必有坚忍不拔之志。 —— 苏轼"},{chapterId:2,name:"第二章",islock:!0,slogan:"坚持意志伟大的事业需要始终不渝的精神。 —— 伏尔泰"},{chapterId:1,name:"第一章",islock:!0,slogan:"聪明出于勤奋，天才在于积累。 —— 华罗庚"},{chapterId:0,name:"自我认知",islock:!1,slogan:"种一棵树最好的时间是十年前，其次是现在，好的开始！"}],eggs:[{chapterId:1,source:window.location.protocol+"//gxbvideo-gs.gaoxiaobang.com/lcms/video/file/2fe02cc6-6371-11e5-a99c-00163e007592.mp4",unlock:!0,title:"催眠离我有多远"},{chapterId:2,source:"",unlock:!1,title:""},{chapterId:3,source:window.location.protocol+"//gxbvideo-gs.gaoxiaobang.com/lcms/video/file/eb3bbaf8-9a3a-11e5-be22-00163e002a3d.mp4",unlock:!0,title:"网络-想说爱你不容易"},{chapterId:4,source:"",unlock:!1,title:""}],testcourceid:[]},angular.forEach(e.$scope.courseData.eggs,function(o,s){o.source&&e.$scope.safeApply(function(){e.$scope.courseData.eggs[s].source=gxb.utils.videoConversionSize(o.source,2)})}),s?e.$courseSrv.getUserInfo("unionid="+e.$scope.courseData.extra.unionId).then(function(o){e.$scope.courseData.serverData.getUserInfo=o,e.$scope.courseData.chapterList=e.$scope.courseData.chapterList.reverse(),e.$scope.courseData.testcourceid=o.testcourceid;for(var s=0;s<o.path.length;s++)s<=o.data.userlock?e.$scope.safeApply(function(){e.$scope.courseData.chapterList[s].islock=!1}):e.$scope.safeApply(function(){e.$scope.courseData.chapterList[s].islock=!0}),e.$scope.safeApply(function(){e.$scope.courseData.chapterList[s].sourceId=o.path[s]});e.$scope.safeApply(function(){e.$scope.courseData.chapterList=e.$scope.courseData.chapterList.reverse()}),setTimeout(function(){gxb.utils.ajaxUtils.scrollToTop($(".chapter__item--"+e.$scope.courseData.serverData.getUserInfo.data.userlock).position().top-500,1e3,function(){e.$scope.safeApply(function(){e.$scope.courseData.extra.progresswidth=parseInt(e.$scope.courseData.serverData.getUserInfo.data.userlock/15*100)+"%",e.$scope.courseData.extra.progresstips=e.$scope.courseData.chapterList.reverse()[e.$scope.courseData.serverData.getUserInfo.data.userlock].slogan,e.$scope.courseData.chapterList.reverse(),$(".progress-tips").addClass("progress-tips--animation")})})},320)},function(){}):e.$state.go("wechat",{},{reload:!0}),e.$scope.toggleAnimation=function(e){$(e).parents(".eggs").find(".shake").toggleClass("eggs__animation")},$("#pageChapterList").on("touchstart",".eggs__mask",function(s){s.preventDefault();var t=$(this);e.$scope.toggleAnimation(this),o=setInterval(function(){150==e.$scope.num&&(clearInterval(o),e.$scope.safeApply(function(){e.$scope.num=0}),t.css("display","none"),t.parents(".eggs").find(".shake").removeClass("eggs__animation"),t.parents(".eggs").find(".eggs__icon--stone").css("display","none"),t.parents(".eggs").find(".eggs__icon--explode").css("display","block").addClass("eggs__animation1"),setTimeout(function(){t.parents(".eggs").find(".shake").hide(),t.parents(".eggs").find(".source").css("display","block"),t.parents(".eggs").removeClass("eggs--lock"),e.ngDialog.open({template:"dialog-chapter-eggs",showClose:!1,closeByDocument:!0,timeout:1500})},1e3)),e.$scope.safeApply(function(){e.$scope.num++})},1)}),$("#pageChapterList").on("touchend",".eggs__mask",function(s){s.preventDefault(),e.$scope.toggleAnimation(this),clearInterval(o),150==e.$scope.num?e.$state.go("course_list",{},{reload:!0}):e.$scope.safeApply(function(){e.$scope.num=0})}),e.$scope.goShowVideo=function(o){e.$scope.safeApply(function(){e.$scope.config.sources=o.source}),0!=sessionStorage.getItem("isWifi")?e.ngDialog.open({template:"dialog4",scope:e.$scope}):e.$scope.showVideo()},e.$scope.showVideo=function(){e.$scope.hideDialog(),e.ngDialog.open({template:"dialog-chapter-eggs-video",closeByDocument:!0,scope:e.$scope}),setTimeout(function(){t.API.play()},1e3)},e.$scope.hideDialog=function(){return e.ngDialog.close("ngdialog1"),!1},e.$scope.nextDialog=function(){e.ngDialog.close("ngdialog1"),e.$scope.showVideo()},e.$scope.indexOf=function(e,o){for(var s=0;s<e.length;s++)if(e[s]==o)return o;return!1},e.$scope.goViewChapterDetail=function(o){o.islock?(e.$scope.safeApply(function(){e.$scope.ngDialogTips="此章被锁住啦，请按顺序学习哦！"}),e.ngDialog.open({template:"dialog-chapter-lock",scope:e.$scope,timeout:1500})):(window.sessionStorage.setItem("chapterId",o.chapterId),window.sessionStorage.setItem("courseId",o.sourceId),40==o.sourceId?e.$state.go("prologue",{},{reload:!0}):39==o.sourceId?e.$state.go("personal_report",{name:s.nickname},{reload:!0}):0==e.$scope.indexOf(e.$scope.courseData.testcourceid,o.sourceId)?e.$state.go("chapter",{chapterId:o.sourceId},{reload:!0}):e.$state.go("quiz",{quizId:o.sourceId},{reload:!0}))},e.$scope.goPersonal=function(){e.$state.go("personal",{},{reload:!0})}},e.inheritFromCtrl(e.course.courseIndexCtrl),e.registerDependency("gxb.controllers.course.courseIndexCtrl",["gxb.services.course.courseSrv","ngDialog","$sce","$location"]),e.registerView("gxb.controllers.course.courseIndexCtrl","course_chapter_list")}(gxb.controllers),function(e){e.course.courseListCtrl=function(e){JSON.parse(window.sessionStorage.getItem("wechatUserInfo"));e.$scope.goCourse=function(){e.$state.go("course_index",{courseId:1},{reload:!0})}},e.inheritFromCtrl(e.course.courseListCtrl),e.registerDependency("gxb.controllers.course.courseListCtrl"),e.registerView("gxb.controllers.course.courseListCtrl","course_list")}(gxb.controllers),function(e){e.chapter.chapterCtrl=function(e){function o(){switch(window.orientation){case 0:$(".videogular-container").addClass("videogular-container1"),$(".videogular-container").css("width",$(window).height()),$(".videogular-container").css("height",$(window).width()),$(".videogular-container").css("left",$(window).width());break;case-90:$(".videogular-container").removeClass("videogular-container1"),$(".videogular-container").css("width",$(window).width()),$(".videogular-container").css("height",$(window).height()),$(".videogular-container").css("left",0);break;case 90:$(".videogular-container").removeClass("videogular-container1"),$(".videogular-container").css("width",$(window).width()),$(".videogular-container").css("height",$(window).height()),$(".videogular-container").css("left",0);break;case 180:$(".videogular-container").addClass("videogular-container1")}}wx.ready(function(){wx.getNetworkType({success:function(e){var o=e.networkType;"wifi"!=o?sessionStorage.setItem("isWifi",1):sessionStorage.setItem("isWifi",0)}})});var s;sessionStorage.getItem("wechatUserInfo")&&(s=JSON.parse(sessionStorage.getItem("wechatUserInfo")).unionid);var t=sessionStorage.getItem("courseId"),n=sessionStorage.getItem("chapterId");e.$scope._is_lock={lock:0,index:0},e.$scope.msg="";var c,i;e.$chapterSrv.testServices(s,t).then(function(o){0==o.statues?o.data.length>0?(e.$scope.safeApply(function(){e.$scope._is_lock={lock:1,index:null};for(var s=0,t=o.data.length;s<t;s++)if(1==o.data[s].type){var c=o.data[s].source.split(".mp4");o.data[s].source=c[0]+"_trans480p.mp4"}o.cource.chapterId=n,e.$scope.chapterData=o;for(var i=0,a=o.data.length;i<a;i++)if(o.data[i].duration>o.data[i].schedule){!function(o){e.$scope._is_lock={lock:0,index:o}}(i);break}}),e.$scope.config={sources:e.$scope.chapterData.data[0].sources,tracks:[{src:window.location.protocol+"//www.videogular.com/assets/subs/pale-blue-dot.vtt",kind:"subtitles",srclang:"en",label:"English","default":""}],theme:"bower_components/videogular-themes-default/videogular.min.css",plugins:{poster:window.location.protocol+"//www.videogular.com/assets/images/videogular.png"},autoPlay:!1,currentTime:!0,nativeFullscreen:!1},e.$scope.onPlayerReady=function(o){e.$scope.$$childHead.API=o}):$(".chapter-list").html("").html("没有数据哦！"):"2"==o.statues?(e.$scope._is_lock={lock:1,index:null},e.$scope.safeApply(function(){e.$scope.chapterData=o,e.$scope.chapterData.cource={},e.$scope.chapterData.cource.chapterId=n,e.$scope.chapterData.cource.cource=o.message,e.$scope.chapterData.cource.courcedescribe="",e.$scope.chapterData.tiaoguo=1})):$(".chapter-list").html("").html("没有数据哦！")}),e.$scope.nextChapter=function(){e.$scope._is_lock.lock?e.$chapterSrv.updatelock(s,n).then(function(o){e.$state.go("course_index",{courseId:1},{reload:!0})}):e.ngDialog.open({template:"externalTemplate.html",controller:"gxb.controllers.chapter.chapterCtrl",showClose:!1,closeByDocument:!0,timeout:1500})},e.$scope.bianlian=0;var a;window.addEventListener("orientationchange",o),e.$scope.showVideo=function(o,s,t,n,r,l){if(c=s,i=n,e.$scope.bianlian=0,1==o){var p=sessionStorage.getItem("isWifi");if(0==p){e.$scope.$$childHead.API.play(),e.$scope.config.sources=t,a=l;var g=0;e.$scope.$$childHead.API.onCanPlay=function(o){n<r&&0==g&&e.$scope.$$childHead.API.seekTime(n,!1),e.$scope.$$childHead.API.play(),e.$scope.$$childHead.API.toggleFullScreen()},e.$scope.$$childHead.API.onPlay=function(){};e.$scope.$$childHead.API.onUpdateTime=function(e){},e.$scope.$$childHead.API.onSeeking=function(o){o.target.currentTime>n&&e.$scope.$$childHead.API.seekTime(n,!1)},e.$scope.$$childHead.API.onStartBuffering=function(o){g=1,n<r&&e.$scope.$$childHead.API.mediaElement[0].currentTime>n&&e.$scope.$$childHead.API.seekTime(e.$scope.bianlian)}}else e.$scope._data={type:o,id:s,src:t,time:n,duration:r,index:l},$("#iswifi").show()}else 2==o&&e.$state.go("quiz",{quizId:s},{reload:!0})},e.$scope.btnYes=function(){$("#iswifi").hide(),e.$scope.config.sources=src,a=index;var o=0;e.$scope.$$childHead.API.onCanPlay=function(s){time<duration&&0==o&&e.$scope.$$childHead.API.seekTime(time,!1),e.$scope.$$childHead.API.play(),e.$scope.$$childHead.API.toggleFullScreen()},e.$scope.$$childHead.API.onPlay=function(){};e.$scope.$$childHead.API.onUpdateTime=function(e){},e.$scope.$$childHead.API.onSeeking=function(o){o.target.currentTime>time&&e.$scope.$$childHead.API.seekTime(time,!1)},e.$scope.$$childHead.API.onStartBuffering=function(s){o=1,time<duration&&e.$scope.$$childHead.API.mediaElement[0].currentTime>time&&e.$scope.$$childHead.API.seekTime(e.$scope.bianlian)}},e.$scope.btnNo=function(){$("#iswifi").hide()},e.$scope.vgUpdateState=function(o){if("pause"==o){var t=parseInt(e.$scope.$$childHead.API.mediaElement[0].currentTime);t=t>i?t:i,e.$chapterSrv.updateschedule(s,t,c).then(function(o){1==o&&e.$scope.safeApply(function(){e.$scope.chapterData.data[a].schedule=t})})}}},e.inheritFromCtrl(e.chapter.chapterCtrl),e.registerDependency("gxb.controllers.chapter.chapterCtrl",["gxb.services.chapter.chapterSrv","$sce","ngDialog"]),e.registerView("gxb.controllers.chapter.chapterCtrl","chapter")}(gxb.controllers),function(e){e.chapter.chapterVideoCtrl=function(e){e.$scope.param="test param",e.$scope.config={sources:[{src:e.$sce.trustAsResourceUrl(window.location.protocol+"//static.videogular.com/assets/videos/videogular.mp4"),type:"video/mp4"},{src:e.$sce.trustAsResourceUrl(window.location.protocol+"//static.videogular.com/assets/videos/videogular.webm"),type:"video/webm"},{src:e.$sce.trustAsResourceUrl(window.location.protocol+"//static.videogular.com/assets/videos/videogular.ogg"),type:"video/ogg"}],tracks:[{src:window.location.protocol+"//www.videogular.com/assets/subs/pale-blue-dot.vtt",kind:"subtitles",srclang:"en",label:"English","default":""}],theme:"bower_components/videogular-themes-default/videogular.css",plugins:{poster:window.location.protocol+"//www.videogular.com/assets/images/videogular.png"}};var o=e.$sce;o.onPlayerReady=function(e){o.API=e}},e.inheritFromCtrl(e.chapter.chapterVideoCtrl),e.registerDependency("gxb.controllers.chapter.chapterVideoCtrl",["$sce"]),e.registerView("gxb.controllers.chapter.chapterVideoCtrl","chapterVideo")}(gxb.controllers),function(e){e.chapter.characterTypeCtrl=function(e){sessionStorage.getItem("wechatUserInfo")&&(userInfo=JSON.parse(sessionStorage.getItem("wechatUserInfo"))),e.$scope.shareAn=!1;var o=e.$stateParams.type;e.$scope.type=o,o?e.$quizSrv.sharePersonality(o).then(function(s){if(s){e.$scope.safeApply(function(){e.$scope.list=s});var t={title:"厉害了，我的哥！我原来是"+s.personalitydesc+"人格，好酷！",link:window.location.protocol+"//psychology.gaoxiaobang.com/dist/#/character_type/"+o,imgUrl:window.location.protocol+"//psychology.gaoxiaobang.com/dist/images/profile_icon.png",desc:"这是我，你呢？选择《心理健康》学分课程，了解自我。"},n=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})},c=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})};wx.ready(function(){wxFun.wx_share(t,n,c)})}}):e.$quizSrv.getPersonality(userInfo.unionid).then(function(o){if(o){e.$scope.safeApply(function(){e.$scope.list=o});var s={title:"厉害了，我的哥！我原来是"+o.personalitydesc+"人格，好酷！",link:window.location.href+o.personalitytype,imgUrl:window.location.protocol+"//psychology.gaoxiaobang.com/dist/images/profile_icon.png",desc:"这是我，你呢？选择《心理健康》学分课程，了解自我。"},t=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})},n=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})};wx.ready(function(){wxFun.wx_share(s,t,n)})}}),e.$scope.share=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!0})},e.$scope.hideAnimation=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})}},e.inheritFromCtrl(e.chapter.characterTypeCtrl),e.registerDependency("gxb.controllers.chapter.characterTypeCtrl",["gxb.services.chapter.quizSrv"]),e.registerView("gxb.controllers.chapter.characterTypeCtrl","character_type")}(gxb.controllers),function(e){e.chapter.prologueCtrl=function(e){var o,s;sessionStorage.getItem("chapterId")&&(o=sessionStorage.getItem("chapterId")),sessionStorage.getItem("wechatUserInfo")&&(s=JSON.parse(sessionStorage.getItem("wechatUserInfo")).unionid),e.$scope.nextChapter=function(){e.$chapterSrv.updatelock(s,o).then(function(o){e.$state.go("course_index",{courseId:1},{reload:!0})})}},e.inheritFromCtrl(e.chapter.prologueCtrl),e.registerDependency("gxb.controllers.chapter.prologueCtrl",["gxb.services.chapter.chapterSrv"]),e.registerView("gxb.controllers.chapter.prologueCtrl","prologue")}(gxb.controllers),function(e){e.chapter.quizCtrl=function(e){var o=[],s=[],t=e.$stateParams.quizId,n=sessionStorage.getItem("chapterId");e.$scope.show=!1,e.$scope.answer=!1,e.$scope.quizSubmission=[],e.$scope.dialog=!1;var c,i;sessionStorage.getItem("wechatUserInfo")&&(i=JSON.parse(sessionStorage.getItem("wechatUserInfo"))),void 0==window.localStorage.max?e.$scope.safeApply(function(){e.$scope.guide=!0}):e.$scope.safeApply(function(){e.$scope.guide=!1}),e.$scope.hideGuide=function(){e.$scope.safeApply(function(){e.$scope.guide=!1,window.localStorage.max="max"})},e.$quizSrv.getTopicList(t,i.unionid).then(function(s){s.tests.length>0&&(1==s.status&&(e.$scope.test=s,e.$scope.test.desc=s.escription,window.sessionStorage.setItem("reportType",s.escription),window.sessionStorage.setItem("result",s.Personalitycharacteristics),e.ngDialog.open({template:"dialog7",scope:e.$scope,closeByDocument:!1})),e.$scope.safeApply(function(){for(var t=0,n=s.tests.length;t<n;t++){var c=[];o.push(c),2==sessionStorage.getItem("courseId")&&!function(e){s.tests[t].sort=t+1}(t)}e.$scope.topicList=s.tests,e.$scope.title=s.testtitle}),c=new TouchSlider("slider",{duration:400,direction:0,fullsize:!0,autoplay:!1}))}),e.$scope.progressW=function(o){var s=100/e.$scope.topicList.length,t=o*s+"%";return t},e.$scope.doAnswer=function(t,n,i,a,r){if("1"==t){o[r-1][i]==n?o[r-1][i]=void 0:o[r-1][i]=n;for(var l=[],p=0;p<o[r-1].length;p++)void 0!=o[r-1][p]&&l.push(o[r-1][p]);var g={};if(g[a]=l.join(","),e.$scope.choice=o,e.$scope.quizSubmission[r-1]=g,0!=s.lenght){for(var p in s)s[p]==r&&(console.log(r),s.splice(p,1));e.$scope.noAnswer=s}console.log(s)}else if("0"==t||"2"==t){if(0!=s.lenght){var u;for(var p in s)s[p]==r&&(u=p);s.splice(u,1),e.$scope.noAnswer=s}e.$scope._index=i,e.$scope._sort=r,o[r-1]=[],o[r-1][i]=n;var l=n,g=new Object;g[a]=l,e.$scope.choice=o,console.log(o),e.$scope.quizSubmission[r-1]=g,r==e.$scope.topicList.length?c.pause():c.next()}},e.$scope.getSubmit=function(){s=[];for(var o=0;o<e.$scope.topicList.length;o++)void 0==e.$scope.quizSubmission[o]&&!function(e){s.push(e+1)}(o);e.$scope.noAnswer=s,0==s.length?(e.$scope.show=!1,e.$quizSrv.getSubmisson(e.$scope.quizSubmission,t,i.unionid).then(function(o){o&&(window.sessionStorage.setItem("result",o.result),window.sessionStorage.setItem("reportType",o.desc),e.$scope.test=o,0==o.type?2==t?e.ngDialog.open({template:"dialog7",scope:e.$scope}):e.ngDialog.open({template:"dialog2",showClose:!1,scope:e.$scope}):2==o.type&&e.ngDialog.open({template:"dialog3",showClose:!1,scope:e.$scope}))})):(e.$scope.show=!0,e.ngDialog.open({template:"dialog5",showClose:!1}),setTimeout(function(){e.ngDialog.close("ngdialog5")},2e3))},e.$scope.goTopic=function(e){c.slide(e-1)},e.$scope.getIntro=function(){e.$state.go("character_type",{reload:!0})},e.$scope.indexOf=function(e,o){for(var s=0;s<e.length;s++)if(e[s]==o)return o;return!1},e.$scope.goChapter=function(){e.ngDialog.close("ngdialog2"),e.$scope.indexOf([2,5,8,15,17],t)?sessionStorage.getItem("mobile")?"1"==sessionStorage.getItem("bindingStatus")?e.$chapterSrv.updatelock(i.unionid,n).then(function(o){e.$state.go("course_index",{courseId:1},{reload:!0})}):e.$state.go("certification",{chapterId:2},{reload:!0}):e.$state.go("bindAccount",{reload:!0}):e.$state.go("chapter",{chapterId:sessionStorage.getItem("chapterId")},{reload:!0})},e.$scope.AgainTpoic=function(){e.ngDialog.close("ngdialog5"),2==t?e.$scope.safeApply(function(){o=[],e.$scope.quizSubmission=[],e.$scope.choice=[],c.slide(0)}):e.$state.reload()},e.$rootScope.$on("$stateChangeSuccess",function(){e.ngDialog.close("ngdialog1")})},e.inheritFromCtrl(e.chapter.quizCtrl),e.registerDependency("gxb.controllers.chapter.quizCtrl",["gxb.services.chapter.quizSrv","ngDialog","gxb.services.chapter.chapterSrv"]),e.registerView("gxb.controllers.chapter.quizCtrl","quiz")}(gxb.controllers),
function(e){e.chapter.reportCtrl=function(e){e.$scope.guide=!0,e.$scope.status=0,e.$scope.show=!0,e.$scope.shareAn=!1,e.$scope.animation=!1,e.$scope.data={},e.$scope.message="";var o=e.$stateParams.id;if(e.$scope.name=e.$stateParams.name,e.$scope.id=o,sessionStorage.getItem("wechatUserInfo")&&(e.$scope.UserInfo=JSON.parse(sessionStorage.getItem("wechatUserInfo"))),sessionStorage.getItem("token"))var s=sessionStorage.getItem("token");e.$userSrv.checkReport(s).then(function(o){o&&(e.$scope.data=o)}),void 0==sessionStorage.getItem("firstTime")?e.$scope.safeApply(function(){e.$scope.status=1,e.$scope.guide=!0}):e.$scope.safeApply(function(){e.$scope.guide=!1}),setTimeout(function(){e.$scope.safeApply(function(){e.$scope.status=0})},3e3),e.$scope.date=function(e){var o,s=new Date(parseInt(e)),t=(s.getFullYear(),s.getMonth()+1),n=s.getDate();return t<10&&(t="0"+t),n<10&&(n="0"+n),o=s.getFullYear()+"."+(s.getMonth()+1)+"."+s.getDate()},e.$scope.goReport=function(){e.$scope.status=1,e.$scope.guide=!1,window.sessionStorage.setItem("firstTime","firstTime")},o?e.$userSrv.shareReport(o).then(function(s){s.data?e.$scope.safeApply(function(){e.$scope.show=!1,e.$scope.report=s.data,e.$scope.name=s.name;var t={title:"高校邦出品的《心理健康》课程，既拿学分又提升自我，同学们，快来选修吧！",link:window.location.protocol+"//psychology.gaoxiaobang.com/dist/#/personal/report/"+s.name+"/"+o,imgUrl:window.location.protocol+"//psychology.gaoxiaobang.com/dist/images/profile_icon.png",desc:"这是我，你呢？选择《心理健康》学分课程，了解真实的自己"},n=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})},c=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})};wx.ready(function(){wxFun.wx_share(t,n,c)})}):(e.$scope.show=!1,e.$scope.message=s.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))}):e.$userSrv.getReport(s).then(function(o){o.data?(1==o.data.exchangecredits?e.$scope.credit=!1:e.$scope.credit=!0,e.$scope.safeApply(function(){e.$scope.show=!0,e.$scope.report=o.data;var s={title:"高校邦出品的《心理健康》课程，既拿学分又提升自我，同学们，快来选修吧！",link:window.location.href+o.data.id,imgUrl:window.location.protocol+"//psychology.gaoxiaobang.com/dist/images/profile_icon.png",desc:"这是我，你呢？选择《心理健康》学分课程，了解真实的自己"},t=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})},n=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})};wx.ready(function(){wxFun.wx_share(s,t,n)})})):(e.$scope.message=o.message,e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))}),e.$scope.getCredit=function(){e.$userSrv.getScore(s).then(function(o){0==o.status?(e.$scope.safeApply(function(){e.$scope.animation=!0}),setTimeout(function(){e.$scope.animations=function(){var e="您已得到2学分";return e}},2e3),setTimeout(function(){e.$scope.safeApply(function(){e.$scope.animation=!1})},3e3),e.$scope.credit=!1):1==o.status&&(e.$scope.animation=!1,e.$scope.credit=!1,e.$scope.message="您已经申请了2学分！",e.ngDialog.open({template:"dialog5",showClose:!1,scope:e.$scope,timeout:1500}))})},e.$scope.share=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!0})},e.$scope.hideAnimation=function(){e.$scope.safeApply(function(){e.$scope.shareAn=!1})}},e.inheritFromCtrl(e.chapter.reportCtrl),e.registerDependency("gxb.controllers.chapter.reportCtrl",["gxb.services.users.userSrv","ngDialog"]),e.registerView("gxb.controllers.chapter.reportCtrl","report")}(gxb.controllers),function(e){e.demo.demoCtrl=function(e){e.$scope.opens=function(o){e.ngDialog.open({template:"dialog"+o,controller:"gxb.controllers.demo.demoCtrl",showClose:!0,closeByDocument:!1,closeByEscape:!1})},e.$scope.opens1=function(){e.ngDialog.open({template:"dialog6",controller:"gxb.controllers.demo.demoCtrl",showClose:!1,closeByDocument:!0})}},e.inheritFromCtrl(e.demo.demoCtrl),e.registerDependency("gxb.controllers.demo.demoCtrl",["ngDialog"]),e.registerView("gxb.controllers.demo.demoCtrl","demo")}(gxb.controllers),function(e){var o=e.controllers,s="gxb.controllers",t="",n=[],c=function(s,t){e.utils.objectUtils.isObjectOnly(s)||(s=n.pop()),n.length&&e.utils.objectUtils.getKeys(s,function(s,i){var a=t+"."+i;e.utils.objectUtils.isObjectOnly(s)?(n.push(s),c(s,a)):e.utils.langUtils.isFunction(s)&&o.registerController(a,o.getDependency(a))})};e.utils.objectUtils.getKeys(o,function(o,i){e.utils.objectUtils.isObjectOnly(o)&&(t=s+"."+i,n.push(o),c(o,t))})}(gxb);