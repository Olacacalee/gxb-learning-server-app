/*!
 * ©2012-2016, gxb.wechat v1.0.0
 * Description: 高校邦微信项目 - 粉笔匠
 * Author: GXB Development Group
 * Build Time: Thu Mar 09 2017 18:25:35 GMT+0800 (CST)
 */
!function(e,t){e.baseDir=function(){},e.baseDir.prototype.getRootPath=function(){return"js/dirViews"},e.baseDir.prototype.resolvePath=function(e){return this.getRootPath()+e+".html"},e.baseDir.prototype.resolveUrl=function(e){e=t.encryptUtils.md5(e||"");var i="<%= remoteServer %><%= suffix %><%= fixed %>";return t.stringUtils.format(i,{remoteServer:gxb.settings.server.remoteServer,suffix:e,fixed:""})}}(gxb.directives,gxb.utils),function(e){e.registerNamespace("gxb.directives.uis")}(gxb.components),function(e,t){e.uis.commonTabDir=function(e){return{restrict:"E",templateUrl:this.resolvePath("/commonTab/commonTab"),replace:!0,controller:["$scope","$element","$state","$stateParams",function(e,t,i,o){var r=o.classId;e.goSupervise=function(){i.go("supervision",{classId:r},{reload:!0})},e.goQuestion=function(){i.go("topic",{classId:r},{reload:!0})},e.goAnnounceTab=function(){i.go("announce_list",{classId:r},{reload:!0})},e.goClasses=function(){i.go("roll_call",{classId:r},{reload:!0})}}]}},e.inheritFromDir(e.uis.commonTabDir),e.registerDirective("commontabs","gxb.directives.uis.commonTabDir",["$compile","$state","$stateParams"])}(gxb.directives,gxb.utils),function(e,t){e.uis.confirmDir=function(e){return{restrict:"E",templateUrl:this.resolvePath("/confirm/confirm"),replace:!0,controller:["$scope","$element",function(e,t){e.confirmCancel=function(){e.confirm=0}}]}},e.inheritFromDir(e.uis.confirmDir),e.registerDirective("confirm","gxb.directives.uis.confirmDir",["$compile","$state","$stateParams"])}(gxb.directives,gxb.utils),function(e,t){e.uis.resourceUploadDir=function(e){return{restrict:"E",templateUrl:this.resolvePath("/resourceupload/resourceupload"),replace:!0,controller:["$scope","$element","$stateParams","$state",function(e,i,o,r){var a=o.classId;i.on("change",function(){var e=i[0].files[0];if(e){document.getElementById("loadingToast").style.display="block";var o=e.type.split("/")[1],n=new FormData;n.append("file",e),n.append("suffix",o),n.append("bucket","gxb-file"),n.append("path","lcms/attachment/link"),"resourceUpload"==r.current.name?t.ajaxUtils.doPost({url:gxb.settings.server.remoteServer+"/resource/class/"+a+"/upload?openId="+window.localStorage.openId,data:n,contentType:!1,processData:!1}).then(function(e){"0"==e.status&&(Zepto("#loadingToast .weui_toast_content").html("上传成功"),setTimeout(function(){document.getElementById("loadingToast").style.display="none",r.go("resourceUpload",{classId:a},{reload:!0})},500))}):t.ajaxUtils.doPost({url:gxb.settings.server.remoteServer+"/resource/class/"+a+"/student/upload?openId="+window.localStorage.openId,data:n,contentType:!1,processData:!1}).then(function(e){"0"==e.status&&(Zepto("#loadingToast .weui_toast_content").html("上传成功"),setTimeout(function(){document.getElementById("loadingToast").style.display="none",r.go("studentResource",{classId:a},{reload:!0})},500))})}})}]}},e.inheritFromDir(e.uis.resourceUploadDir),e.registerDirective("upload","gxb.directives.uis.resourceUploadDir",[])}(gxb.directives,gxb.utils),function(e,t){e.uis.tabDir=function(e){e.$stateParams.classId;return{restrict:"E",templateUrl:this.resolvePath("/tab/tab"),replace:!0,controller:["$scope","$element","$state","$stateParams",function(e,t,i,o){var r=o.classId;e.goCall=function(){i.go("roll_call",{classId:r},{reload:!0})},e.goTest=function(){i.go("class_quiz",{classId:r},{reload:!0})},e.goShake=function(){i.go("shake",{classId:r},{reload:!0})}}]}},e.inheritFromDir(e.uis.tabDir),e.registerDirective("wechattab","gxb.directives.uis.tabDir",["$compile","$state","$stateParams"])}(gxb.directives,gxb.utils),function(e,t){e.uis.timestamp=function(e){return{restrict:"E",replace:!0,controller:["$scope","$element","$attrs",function(e,t,i){setTimeout(function(){var e=1*t[0].dataset.value;t[0].innerHTML=moment(e).format("YYYY-MM-DD")},100)}]}},e.inheritFromDir(e.uis.timestamp),e.registerDirective("timestamp","gxb.directives.uis.timestamp",[])}(gxb.directives,gxb.utils),function(e,t){e.uis.uploadAvatarDir=function(e){var i=gxb.utils.jsonUtils.toObject(window.localStorage.userInfo);return{restrict:"E",templateUrl:this.resolvePath("/uploadavatar/uploadavatar"),replace:!0,controller:["$scope","$element",function(e,o){o.on("change",function(){var r=200,a=o[0].files[0];if(a){document.getElementById("loadingToast").style.display="block";var n=a.type||null,s=a.type.split("/")[1],l=new Image;l.onload=function(){console.log(l.width,l.height),l.height>r&&(l.width*=r/l.height,l.height=r);var a=document.createElement("canvas");a.id="myCanvas";var c=a.getContext("2d");a.width=l.width,a.height=l.height,c.drawImage(l,0,0,l.width,l.height),document.body.appendChild(a);var u=a.toDataURL(n),d=encodeURIComponent(u),p=new FormData;p.append("suffix",s),p.append("strBase64",d),document.body.removeChild(a),t.ajaxUtils.doPost({url:gxb.settings.server.remoteServer+"/upload/file/api?path=uploads/avatar/link&imgSmall=1&openId="+window.localStorage.openId,data:p,contentType:!1,processData:!1}).then(function(r){var a=r;"0"==r.status&&(document.getElementById("loadingToast").style.display="none",o[0].setAttribute("data-file",r.data),console.log(o[0].previousSibling.previousSibling),o[0].previousSibling.previousSibling.setAttribute("src",u),e.$apply(),t.ajaxUtils.doPost({url:gxb.settings.server.remoteServer+"/user/userResetLink/api?openId="+window.localStorage.openId,data:{link:r.data},contentType:"application/json"}).then(function(e){var t=e;"0"===t.status&&(i.avatarUrl=gxb.settings.cdn.wangsu.getDomains().defaultBucketDomain+a.data,window.localStorage.userInfo=gxb.utils.jsonUtils.toString(i))}))})};var c=new FileReader;c.onload=function(){l.src=c.result},c.readAsDataURL(a)}})}]}},e.inheritFromDir(e.uis.uploadAvatarDir),e.registerDirective("uploadavatar","gxb.directives.uis.uploadAvatarDir",[])}(gxb.directives,gxb.utils),function(e,t){e.uis.uploadFileDir=function(e){return{restrict:"E",templateUrl:this.resolvePath("/uploadFile/uploadFile"),replace:!0,controller:["$scope","$element",function(e,i){i.on("change",function(){var o=1e3,r=i[0].files[0];if(r){document.getElementById("loadingToast").style.display="block";var a=r.type||null,n=r.type.split("/")[1],s=new Image;s.onload=function(){console.log(s.width,s.height),s.height>o&&(s.width*=o/s.height,s.height=o);var r=document.createElement("canvas");r.id="myCanvas";var l=r.getContext("2d");r.width=s.width,r.height=s.height,l.drawImage(s,0,0,s.width,s.height),document.body.appendChild(r);var c=r.toDataURL(a),u=encodeURIComponent(c),d=new FormData;d.append("suffix",n),d.append("strBase64",u),document.body.removeChild(r),t.ajaxUtils.doPost({url:gxb.settings.server.remoteServer+"/upload/file/api?path=uploads/course_image/link&openId="+window.localStorage.openId,data:d,contentType:!1,processData:!1}).then(function(t){"0"==t.status&&(document.getElementById("loadingToast").style.display="none",document.getElementById("toast").style.display="block",setTimeout(function(){document.getElementById("toast").style.display="none"},1e3),i[0].setAttribute("data-file",t.data),i[0].previousSibling.previousSibling.setAttribute("src",c),e.$apply())})};var l=new FileReader;l.onload=function(){s.src=l.result},l.readAsDataURL(r)}})}]}},e.inheritFromDir(e.uis.uploadFileDir),e.registerDirective("uploadfile","gxb.directives.uis.uploadFileDir",[])}(gxb.directives,gxb.utils),function(e,t){e.uis.warningDir=function(e){return{restrict:"E",templateUrl:this.resolvePath("/warning/warning"),replace:!0,controller:["$scope","$element",function(e,t){e.getKnow=function(){e.warning=0}}]}},e.inheritFromDir(e.uis.warningDir),e.registerDirective("warning","gxb.directives.uis.warningDir",["$compile","$state","$stateParams"])}(gxb.directives,gxb.utils);